<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="content-column.html">

<dom-module id="time-line">
  <template>
  <style include="app-grid-style">
     :host {
       display: block;
       --app-grid-columns: [[currentSetting.column_number]];
       --app-grid-expandible-item-columns: 1;
       --paper-icon-button-ink-color: white;
     }
     ul {
       padding: 0;
       list-style: none;
       width:[[currentSetting.ul_width]]
     }
     .centered-container {
       margin-top: 40px;
       width: 100%;
     }
     .item {
       height: 550px;
       position: relative;
       background-color: white;
       background-size: cover;
       background-position: center center;
       border-left: 1px solid black;
     }
     .born, .death{
       height:40%;
       width:100%
     }
     .event{
       height:20%;background:#fff;width:100%;border-bottom:1px solid black
     }


   </style>
   [[data]]
   <paper-button on-click="zoomIn" raised class="indigo">+</paper-button>
   <paper-button on-click="zoomOut" raised class="indigo">-</paper-button>
   <div class="centered-container" style="overflow-x:scroll; ">
      <ul class="app-grid">
        <li class="item" style="background-color:#cfd8dc;">
          <div class="born">Birth Year</div>
          <div class="event">Year</div>
          <div class="death">Death Year</div>
        </li>
        <template id="timelineList" is="dom-repeat" items="{{currentData}}" as ="timeSlot">
          <li class="item" style="background-color: #cfd8dc;">
              <div class="born">
                <template is="dom-repeat" items="{{timeSlot.born}}" as="person"index-as="person_index">
                  <img src="[[person.img]]" alt="">
                  <p>[[person.title]]</p>
                  <p>[[person.year.born]]</p>
                </template>
              </div>
              <div class="event">
                <div class="">
                  [[timeSlot.year.year]]
                </div>
                <div class="">
                  [[timeSlot.year.event]]
                </div>
              </div>
              <div class="death">
                <template is="dom-repeat" items="{{timeSlot.death}}" as="person"index-as="person_index">
                  <img src="[[person.img]]" alt="">
                  <p>[[person.title]]</p>
                  <p>[[person.year.die]]</p>
                </template>
              </div>
          </li>
        </template>
      </ul>
    </div>
  </template>
  <script>
    console.log("test");
    class TimeLine extends Polymer.Element {
      static get is() { return 'time-line'; }
      static get properties() {
        return {
          data: {
            type: Object,
            observer: '_activeChanged'

          },
          currentSetting: {
            type: Object,
            value: {
              column_number: "12",
              ul_width: "100%",
            }
          },
          zoomOutSetting: {
            type: Object,
            value: {
              column_number: "12",
              ul_width: "100%",
            }
          },
          zoomInSetting: {
            type: Object,
            value: {
              column_number: "103",
              ul_width: "1000%",
            }
          },
          currentData:{
            type:Array
          },
          zoomInData: {
            type: Array
          },
          zoomOutData: {
            type: Array
          },
          zoomToggle: {
            type:Boolean,
            value:true
          }
        };
      }



      _activeChanged(newValue, oldValue) {
        console.log('oldValue:', oldValue,'newValue:', newValue);

        if(Object.keys(newValue).length !== 0){
          var zoomOutBornIndex = parseInt(newValue.year.born/200)+1;
          var zoomInBornIndex = parseInt(newValue.year.born/20)+1;

          var zoomOutBorn = this.zoomOutData[zoomOutBornIndex];
          var zoomInBorn = this.zoomInData[zoomInBornIndex];

          var bornOutData = zoomOutBorn.born.slice();
          var bornInData = zoomInBorn.born.slice();

          bornOutData.push(newValue);
          bornInData.push(newValue);
          this.set('zoomOutData.'+ zoomOutBornIndex, {born: bornOutData,year:zoomOutBorn.year,death:zoomOutBorn.death});
          //this.push('zoomOutData.'+ zoomOutBornIndex+'.born',newValue)
          this.set('zoomInData.'+ zoomInBornIndex, {born: bornInData,year:zoomInBorn.year,death:zoomInBorn.death});
          //this.push('zoomInData.'+ zoomInBornIndex+'.born',newValue)
          if(newValue.year.die){
            var zoomOutDeathIndex = parseInt(newValue.year.die/200)+1;
            var zoomInDeathIndex = parseInt(newValue.year.die/20)+1;

            var zoomOutDeath = this.zoomOutData[zoomOutDeathIndex];
            var zoomInDeath = this.zoomInData[zoomInDeathIndex];

            var deathOutData = zoomOutBorn.death.slice();
            var deathInData = zoomInBorn.death.slice();

            deathOutData.push(newValue);
            deathInData.push(newValue);

            this.set('zoomOutData.'+ zoomOutDeathIndex, {born: zoomOutDeath.born,year:zoomOutDeath.year,death:deathOutData});
            //this.push('zoomOutData.'+ zoomOutDeathIndex+'.death',newValue)
            this.set('zoomInData.'+ zoomInDeathIndex, {born: zoomInDeath.bron,year:zoomInDeath.year,death:deathInData});
            //this.push('zoomInData.'+ zoomInDeathIndex+'.death',newValue)

          }
          if(this.zoomToggle){
            this.zoomOut();
          }else{
            this.zoomIn();
          }
        }

        // }.bind(this))
        // console.log(this.zoomOutData)
        // this.currentData = this.zoomOutData

      }

      constructor() {
        super();
        this._createZoomOutData();
        this._createZoomInData();
        this.currentData = this.zoomOutData
      }

      add(){
        this.push('currentData', "test")
        console.log("add")
      }

      _createZoomInData(){
        var arr = [];
        for(var i = 0; i<=101;i++){
          arr.push({
            born: [],
            year: { "year" :i*20,
                    "event":''
                  },
            death:[]
          })
        }
        this.zoomInData = arr;
      }
      _createZoomOutData(){
        var arr = [];
        for(var i = 0; i<=10;i++){
          arr.push({
            born: [],
            year: { "year" :i*200,
                    "event":''
                  },
            death:[]
          })
        }
        this.zoomOutData = arr;
      }
      zoomIn() {
          this.currentSetting = this.zoomInSetting;
          this.currentData = this.zoomInData.slice();
          this.zoomToggle = false
      }
      zoomOut() {
          this.currentSetting = this.zoomOutSetting;
          this.currentData = this.zoomOutData.slice();
          this.zoomToggle = true
          console.log("zoomout",this.currentData)
      }

    }
    customElements.define(TimeLine.is, TimeLine);
  </script>
</dom-module>
